{
  "version": "2.0.0",
  "description": "Persistent tracking for /review-all across sessions. Claude MUST read this file at the start of every /review-all invocation.",
  "created": "2026-02-05",
  "last_updated": "2026-02-05",

  "format_changelog": {
    "v2.0.0": "Redesigned review-all to run 6 specialists (added red-team + chaos-audit). Reset sessions for fresh run. Archived v1 results. Fixed 'performance' â†’ 'optimise' naming.",
    "v1.0.0": "Original 4-specialist format (standards, security, performance, stability)"
  },

  "specialists": [
    "standards",
    "security",
    "red-team",
    "optimise",
    "stability",
    "chaos-audit"
  ],

  "codebase_map": {
    "total_packages": 13,
    "total_go_files": 155,
    "total_test_files": 35,
    "total_loc_approx": 23500,
    "packages": {
      "cmd/graylogic": {
        "files": 2,
        "test_files": 1,
        "loc": 400,
        "category": "entrypoint"
      },
      "internal/api": {
        "files": 26,
        "test_files": 3,
        "loc": 3200,
        "category": "api"
      },
      "internal/auth": {
        "files": 19,
        "test_files": 8,
        "loc": 1900,
        "category": "security"
      },
      "internal/device": {
        "files": 21,
        "test_files": 6,
        "loc": 2800,
        "category": "domain"
      },
      "internal/automation": {
        "files": 12,
        "test_files": 5,
        "loc": 1700,
        "category": "domain"
      },
      "internal/bridges/knx": {
        "files": 22,
        "test_files": 7,
        "loc": 4500,
        "category": "protocol"
      },
      "internal/knxd": {
        "files": 4,
        "test_files": 1,
        "loc": 1400,
        "category": "protocol"
      },
      "internal/process": {
        "files": 3,
        "test_files": 1,
        "loc": 850,
        "category": "infrastructure"
      },
      "internal/location": {
        "files": 8,
        "test_files": 2,
        "loc": 1200,
        "category": "domain"
      },
      "internal/commissioning/etsimport": {
        "files": 6,
        "test_files": 1,
        "loc": 2800,
        "category": "commissioning"
      },
      "internal/audit": {
        "files": 1,
        "test_files": 0,
        "loc": 200,
        "category": "infrastructure"
      },
      "internal/infrastructure/database": {
        "files": 5,
        "test_files": 2,
        "loc": 600,
        "category": "infrastructure"
      },
      "internal/infrastructure/logging": {
        "files": 3,
        "test_files": 1,
        "loc": 250,
        "category": "infrastructure"
      },
      "internal/infrastructure/mqtt": {
        "files": 9,
        "test_files": 2,
        "loc": 800,
        "category": "infrastructure"
      },
      "internal/infrastructure/tsdb": {
        "files": 7,
        "test_files": 2,
        "loc": 500,
        "category": "infrastructure"
      },
      "internal/infrastructure/config": {
        "files": 3,
        "test_files": 1,
        "loc": 900,
        "category": "infrastructure"
      },
      "internal/panel": {
        "files": 3,
        "test_files": 1,
        "loc": 350,
        "category": "infrastructure"
      }
    }
  },

  "review_plan": {
    "description": "Systematic full-codebase review in 5 sessions, ordered by risk. Each session runs 6 specialists: standards, security, red-team, optimise, stability, chaos-audit.",
    "sessions": [
      {
        "session": 1,
        "name": "Security Core + Auth Handlers",
        "status": "completed",
        "completed_date": "2026-02-05",
        "packages": [
          "internal/auth",
          "internal/api (auth handlers: auth.go, users.go, panels.go, middleware.go)"
        ],
        "focus": "Auth system deep dive: RBAC, JWT, token lifecycle, password handling, session management.",
        "note": "v1: 22 findings fixed (8adc4e0). v2: 5 findings (3 fixed, 2 accepted) in 9285153."
      },
      {
        "session": 2,
        "name": "API Layer + WebSocket",
        "status": "completed",
        "completed_date": "2026-02-05",
        "packages": [
          "internal/api (handlers: devices.go, scenes.go, locations.go, groups.go, zones.go, tags.go, hierarchy.go, state_history.go, discovery.go, commissioning.go, audit.go, metrics.go, system.go, site.go)",
          "internal/api (websocket.go, errors.go, router.go)"
        ],
        "focus": "All non-auth API handlers, WebSocket hub, error handling, routing.",
        "note": "v2: 8 findings (6 fixed, 2 accepted) in e5a15cd."
      },
      {
        "session": 3,
        "name": "Domain Logic + State Management",
        "status": "pending",
        "packages": [
          "internal/device",
          "internal/automation",
          "internal/location"
        ],
        "focus": "Device registry, state management, group resolution, scene engine, location hierarchy."
      },
      {
        "session": 4,
        "name": "Protocol Layer + Subprocess Management",
        "status": "pending",
        "packages": [
          "internal/bridges/knx",
          "internal/knxd",
          "internal/process",
          "internal/commissioning/etsimport"
        ],
        "focus": "KNX bridge, DPT encoding, telegram handling, knxd subprocess, process lifecycle, ETS import."
      },
      {
        "session": 5,
        "name": "Infrastructure + Integration + Wiring",
        "status": "pending",
        "packages": [
          "internal/infrastructure/database",
          "internal/infrastructure/mqtt",
          "internal/infrastructure/tsdb",
          "internal/infrastructure/config",
          "internal/infrastructure/logging",
          "internal/panel",
          "internal/audit",
          "cmd/graylogic"
        ],
        "focus": "Database layer, MQTT client, TSDB client, config validation, logging, main.go wiring."
      }
    ]
  },

  "completed_reviews": [
    {
      "session": 1,
      "date": "2026-02-05",
      "name": "Security Core + Auth Handlers",
      "loc_reviewed": 3270,
      "specialists_run": [
        "standards",
        "security",
        "red-team",
        "optimise",
        "stability",
        "chaos-audit"
      ],
      "findings": {
        "critical": [],
        "high": [],
        "medium": [
          {
            "id": "S1v2-M1",
            "title": "Panel UpdateLastSeen uses context.Background()",
            "status": "fixed",
            "fix_commit": "9285153"
          },
          {
            "id": "S1v2-M2",
            "title": "User deletion orphans room_access rows",
            "status": "accepted",
            "reason": "FK CASCADE handles cleanup"
          }
        ],
        "low": [
          {
            "id": "S1v2-L1",
            "title": "No display name length validation",
            "status": "fixed",
            "fix_commit": "9285153"
          },
          {
            "id": "S1v2-L2",
            "title": "PermissionsForRole allocates per call",
            "status": "accepted",
            "reason": "Not hot path; copy prevents mutation"
          },
          {
            "id": "S1v2-L3",
            "title": "No resilience tests for auth",
            "status": "fixed",
            "fix_commit": "9285153"
          }
        ]
      },
      "scores": {
        "standards": 9.5,
        "security": 9.0,
        "red_team": 9.0,
        "optimise": 9.0,
        "stability": 9.0,
        "chaos_audit": 8.5
      },
      "overall_score": 9.0
    },
    {
      "session": 2,
      "date": "2026-02-05",
      "name": "API Layer + WebSocket",
      "loc_reviewed": 4800,
      "specialists_run": [
        "standards",
        "security",
        "red-team",
        "optimise",
        "stability",
        "chaos-audit"
      ],
      "findings": {
        "critical": [],
        "high": [],
        "medium": [
          {
            "id": "S2v2-M1",
            "title": "WebSocket CheckOrigin always returns true",
            "status": "fixed",
            "fix_commit": "e5a15cd"
          },
          {
            "id": "S2v2-M2",
            "title": "Hierarchy N+1 query pattern",
            "status": "accepted",
            "reason": "FALSE POSITIVE: ListDevices/ListScenes use in-memory cache"
          },
          {
            "id": "S2v2-M3",
            "title": "MQTT callback uses context.Background()",
            "status": "fixed",
            "fix_commit": "e5a15cd"
          }
        ],
        "low": [
          {
            "id": "S2v2-L1",
            "title": "discovery.go time.Now() without UTC",
            "status": "fixed",
            "fix_commit": "e5a15cd"
          },
          {
            "id": "S2v2-L2",
            "title": "No ID length validation on locations",
            "status": "fixed",
            "fix_commit": "e5a15cd"
          },
          {
            "id": "S2v2-L3",
            "title": "formatInt reimplements strconv.Itoa",
            "status": "fixed",
            "fix_commit": "e5a15cd"
          },
          {
            "id": "S2v2-L4",
            "title": "discovery.go scan errors silently skipped",
            "status": "fixed",
            "fix_commit": "e5a15cd"
          },
          {
            "id": "S2v2-L5",
            "title": "No mutex on factory reset",
            "status": "fixed",
            "fix_commit": "e5a15cd"
          }
        ]
      },
      "scores": {
        "standards": 9.5,
        "security": 9.0,
        "red_team": 9.5,
        "optimise": 8.5,
        "stability": 9.0,
        "chaos_audit": 8.5
      },
      "overall_score": 9.0
    }
  ],

  "findings_summary": {
    "total_findings": 13,
    "by_severity": { "critical": 0, "high": 0, "medium": 5, "low": 8 },
    "by_status": { "fixed": 9, "accepted": 4, "open": 0 },
    "session_1_v2": { "total": 5, "fixed": 3, "accepted": 2, "open": 0 },
    "session_2_v2": { "total": 8, "fixed": 6, "accepted": 2, "open": 0 }
  },

  "archived_runs": {
    "description": "Previous review results from v1.0.0 format (4 specialists only).",
    "v1_sessions": [
      {
        "session": 1,
        "date": "2026-02-05",
        "findings_count": { "critical": 2, "high": 5, "medium": 11, "low": 4 },
        "total": 22,
        "fix_status": "all_fixed",
        "fix_commit": "8adc4e0"
      },
      {
        "session": 2,
        "date": "2026-02-05",
        "findings_count": { "critical": 0, "high": 1, "medium": 7, "low": 3 },
        "total": 11,
        "fix_status": "superseded_by_v2"
      }
    ]
  }
}
